---
title: TLS接続を行う設定ファイルを登録する
---

SINETStreamでブローカにTLS接続を行う設定を登録する手順を示します。

ここではブローカにTLS接続するSINETStream設定ファイルとして、以下の内容のものをコンフィグサーバに登録する手順を示します。


```yaml
service-mqtt-003:
  type: mqtt
  brokers: mqtt.example.org:8883
  topic: topic-mqtt-003
  consitency: AT_LEAST_ONCE
  value_type: text
  tls:
    ca_certs_data: !!binary |-
      Q2VydGlmaWNhdGU6CiAgICBEYXRhOgogICAgICAgIFZlcnNpb246IDMgKDB4MikKICAgICAg
(以下略)
```

上記の設定ファイルではブローカとのTLS接続にプライベート認証局で発行した証明書を利用することを想定しています。そのため`ca_certs_data`でCA証明書の指定を行っています。

## コンフィグ情報の登録

SINETStream設定ファイルをコンフィグサーバに登録します。設定ファイルのうちCA証明書は添付ファイルとして別に登録を行うので、ここではそれ以外の部分についての登録を行います。はじめに示した設定ファイルのうち `ca_certs_data` とその親要素である `tls` の部分を省いた以下の内容を設定ファイルとして登録します。

```yaml
service-mqtt-003:
  type: mqtt
  brokers: mqtt.example.org:8883
  topic: topic-mqtt-003
  consitency: AT_LEAST_ONCE
  value_type: text
```

コンフィグ情報一覧画面、またはホーム画面からコンフィグ情報登録ダイアログを表示してください。ダイアログの表示手順については「[データ暗号化行う設定ファイルを登録する](../guide-03)」、「[設定ファイルを登録する](../guide-02)」を確認してください。

![コンフィグ情報登録ダイアログ](../img/guide-04-001.png)

「SINETStream設定ファイル」の欄に、この節のはじめに示した内容を入力してください。また「名前」「コメント」欄に入力を行ったうえで「登録」ボタンを選択してください。


## 添付ファイルの登録

前節で登録したコンフィグ情報にCA証明書を添付ファイルとして追加します。

先ほど登録したコンフィグ情報の詳細画面を表示してください。コンフィグ情報一覧画面に表示されている「名前」の列から対応するものを選択することで詳細画面を表示することが出来ます。

![コンフィグ情報1](../img/guide-04-010.png)

コンフィグ情報詳細画面の下部に「添付ファイル」と表示されている部分（上図赤丸部分）があります。デフォルトでは折りたたまれて表示されますがクリックすることで下図のように展開されて表示されます。

![コンフィグ情報2](../img/guide-04-011.png)

展開された「添付ファイル」のパネルにある登録ボタン（上図赤丸部分）をクリックすることで添付ファイルの登録ダイアログが表示されます。

![添付ファイル登録ダイアログ1](../img/guide-04-012.png)

「添付ファイル」欄をクリックすることでファイル選択ダイアログが表示されます。登録するCA証明書を選択してください。

「埋め込み先」欄にに入力する値で添付ファイルをSINETStream設定ファイルのどの部分に埋め込むかを指定することが出来ます。位置の指定は設定ファイルのサービス名（ここでは`service-mqtt-003`）以下の各要素のキー名を `.` で連結したもので行います。この例ではCA証明書を `tls`, `ca_certs_data` に埋め込むので `service-mqtt-003.tls.ca_certs_data` を指定すればよいことになります。ただしサービス名については `*` を指定することで設定ファイル内の全てのサービスを埋め込み対象として指定することが出来ます。そこで、ここではダイアログの「埋め込み先」として `*.tls.ca_certs_data` を指定します。

![添付ファイル登録ダイアログ2](../img/guide-04-013.png)

最後にダイアログの「登録」ボタンをクリックすると添付ファイルが登録されます。添付ファイルが登録されるとコンフィグ情報詳細画面の「添付ファイル」のパネルに登録内容が表示されます。

![コンフィグ情報3](../img/guide-04-014.png)

コンフィグ情報詳細画面の「設定ファイル」の欄の表示内容も更新されています。`ca_certs_data`が追加されていることが確認出来ます（下図赤枠部分）。

![コンフィグ情報4](../img/guide-04-015.png)
